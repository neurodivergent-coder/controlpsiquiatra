<!DOCTYPE html>
<html lang="es" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Evaluaci√≥n Psiqui√°trica - Dr. Humberto Nicolini</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .question-card {
        transition: all 0.3s ease;
        border-left: 4px solid #3b82f6;
      }

      .scale-button {
        transition: all 0.2s ease;
      }

      .scale-button:hover {
        transform: scale(1.1);
      }

      .scale-button.selected {
        transform: scale(1.15);
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .progress-bar {
        transition: width 0.5s ease;
      }

      .chart-container {
        position: relative;
        height: 400px;
        margin: 20px 0;
      }

      /* Chatbot styles */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chat-message {
        animation: slideIn 0.3s ease-out;
      }

      .typing-indicator {
        display: inline-flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #9ca3af;
        animation: typing 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.7;
        }
        30% {
          transform: translateY(-10px);
          opacity: 1;
        }
      }

      .chat-messages-area {
        height: 500px;
        overflow-y: auto;
      }

      .chat-messages-area::-webkit-scrollbar {
        width: 8px;
      }

      .chat-messages-area::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 10px;
      }

      .chat-messages-area::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }

      .chat-messages-area::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      .quick-action-btn {
        transition: all 0.3s ease;
      }

      .quick-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body class="h-full bg-gradient-to-br from-blue-50 via-white to-indigo-50">
    <div class="h-full flex flex-col">
      <!-- Header -->
      <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-6 py-4">
          <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4">
              <div
                class="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center"
              >
                <span class="text-white font-bold text-xl">üß†</span>
              </div>
              <div>
                <h1 class="text-2xl font-bold text-gray-800">
                  Dr. Humberto Nicolini
                </h1>
                <p class="text-sm text-gray-600">
                  Psiquiatra por parte del Consejo Mexicano de Psiquiatr√≠a
                </p>
                <p class="text-sm text-gray-600">
                  Evaluaci√≥n TDA/TDAH - Doctorado en Ciencias M√©dicas UNAM
                </p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600" id="currentDate"></p>
              <p
                class="text-lg font-semibold text-blue-600"
                id="currentTime"
              ></p>
            </div>
          </div>
        </div>
      </header>
      <div class="flex-1 overflow-auto">
        <div class="container mx-auto px-6 py-8">
          <!-- Navigation -->
          <nav class="mb-8">
            <div class="flex flex-wrap gap-4 justify-center">
              <button
                onclick="showSection('questionnaire')"
                class="nav-item bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg"
                id="nav-questionnaire"
              >
                Cuestionario de Evaluaci√≥n
              </button>
              <button
                onclick="showSection('results')"
                class="nav-item bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-lg"
                id="nav-results"
              >
                Resultados y Gr√°ficos
              </button>
              <button
                onclick="showSection('history')"
                class="nav-item bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-lg"
                id="nav-history"
              >
                Historial de Evaluaciones
              </button>
              <button
                onclick="showSection('chatbot')"
                class="nav-item bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-lg"
                id="nav-chatbot"
              >
                ü§ñ Asistente Virtual
              </button>
            </div>
          </nav>
          <!-- Questionnaire Section -->
          <div id="questionnaire-section" class="section fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-8">
              <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">
                  Evaluaci√≥n TDA/TDAH
                </h2>
                <p class="text-gray-600">
                  Responde cada pregunta seg√∫n tu experiencia HOY o en las
                  √∫ltimas 24 horas
                </p>
                <div class="mt-4">
                  <div
                    class="bg-gray-200 rounded-full h-3 w-full max-w-md mx-auto"
                  >
                    <div
                      id="progressBar"
                      class="progress-bar bg-blue-600 h-3 rounded-full"
                      style="width: 0%"
                    ></div>
                  </div>
                  <p class="text-sm text-gray-600 mt-2">
                    Pregunta <span id="currentQuestion">0</span> de
                    <span id="totalQuestions">0</span>
                  </p>
                </div>
              </div>
              <!-- Patient Info -->
              <div
                id="patientInfo"
                class="mb-8 p-6 bg-blue-50 rounded-xl border-2 border-blue-200"
              >
                <h3 class="text-lg font-bold text-blue-800 mb-4">
                  üë§ Informaci√≥n del Paciente
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <input
                    type="text"
                    id="patientName"
                    placeholder="Nombre completo"
                    class="p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                  <input
                    type="number"
                    id="patientAge"
                    placeholder="Edad"
                    class="p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                  <input
                    type="date"
                    id="evaluationDate"
                    class="p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>
              <!-- Questions Container -->
              <div id="questionsContainer">
                <!-- Questions will be generated here -->
              </div>
              <!-- Navigation Buttons -->
              <div class="flex justify-between mt-8">
                <button
                  id="prevBtn"
                  onclick="previousQuestion()"
                  class="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 transition-colors disabled:opacity-50"
                  disabled
                >
                  ‚Üê Anterior
                </button>
                <button
                  id="nextBtn"
                  onclick="nextQuestion()"
                  class="bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors"
                >
                  Siguiente ‚Üí
                </button>
                <button
                  id="finishBtn"
                  onclick="finishEvaluation()"
                  class="hidden bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition-colors"
                >
                  Finalizar Evaluaci√≥n
                </button>
              </div>
            </div>
          </div>
          <!-- Results Section -->
          <div id="results-section" class="section hidden">
            <div class="bg-white rounded-2xl shadow-lg p-8">
              <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                Resultados de la Evaluaci√≥n
              </h2>
              <!-- Current Results -->
              <div id="currentResults" class="mb-8">
                <div class="max-w-4xl mx-auto">
                  <!-- Scores Summary -->
                  <div
                    class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200"
                  >
                    <h3 class="text-xl font-bold text-blue-800 mb-4">
                      Puntuaciones por Categor√≠a
                    </h3>
                    <div id="scoresDisplay" class="space-y-4">
                      <!-- Scores will be displayed here -->
                    </div>
                  </div>
                </div>
              </div>
              <!-- Charts -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Bar Chart -->
                <div
                  class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm"
                >
                  <h3 class="text-lg font-bold text-gray-800 mb-4">
                    Gr√°fico de Barras - Puntuaciones
                  </h3>
                  <div class="chart-container">
                    <canvas id="barChart"></canvas>
                  </div>
                </div>
                <!-- Pie Chart -->
                <div
                  class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm"
                >
                  <h3 class="text-lg font-bold text-gray-800 mb-4">
                    Distribuci√≥n
                  </h3>
                  <div class="chart-container">
                    <canvas id="pieChart"></canvas>
                  </div>
                </div>
              </div>
              <!-- Export Options -->
              <div class="mt-8 text-center">
                <button
                  onclick="exportToExcel()"
                  class="bg-green-600 text-white px-6 py-3 rounded-xl hover:bg-green-700 transition-colors mr-4"
                >
                  Exportar a Excel
                </button>
                <button
                  onclick="printResults()"
                  class="bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors"
                >
                  üñ®Ô∏è Imprimir Reporte
                </button>
              </div>
            </div>
          </div>
          <!-- History Section -->
          <div id="history-section" class="section hidden">
            <div class="bg-white rounded-2xl shadow-lg p-8">
              <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">
                üìà Historial de Evaluaciones
              </h2>
              <!-- Trend Chart -->
              <div class="mb-8">
                <div
                  class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200"
                >
                  <h3 class="text-xl font-bold text-purple-800 mb-4">
                    üìà Tendencias a lo Largo del Tiempo
                  </h3>
                  <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                  </div>
                </div>
              </div>
              <!-- History List -->
              <div id="historyList" class="space-y-4">
                <!-- History items will be displayed here -->
              </div>
            </div>
          </div>
          <!-- Chatbot Section -->
          <div id="chatbot-section" class="section hidden">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
              <!-- Chat Header -->
              <div
                class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-6 py-4"
              >
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-12 h-12 bg-white rounded-full flex items-center justify-center"
                    >
                      <span class="text-3xl">ü§ñ</span>
                    </div>
                    <div>
                      <h2 class="text-xl font-bold">
                        Asistente Virtual Dr. Nicolini
                      </h2>
                      <p class="text-sm text-blue-100">
                        En l√≠nea ‚Ä¢ Responde en segundos
                      </p>
                    </div>
                  </div>
                  <button
                    onclick="clearChat()"
                    class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg text-sm transition-all"
                  >
                    üóëÔ∏è Limpiar
                  </button>
                </div>
              </div>
              <!-- Messages Area -->
              <div id="chatMessages" class="chat-messages-area bg-gray-50 p-6">
                <!-- Messages will appear here -->
              </div>
              <!-- Quick Actions -->
              <div class="px-6 py-3 bg-white border-t border-gray-200">
                <p class="text-xs text-gray-500 mb-2">üöÄ Acciones r√°pidas:</p>
                <div class="flex flex-wrap gap-2" id="quickActions">
                  <!-- Quick action buttons -->
                </div>
              </div>
              <!-- Input Area -->
              <div class="bg-white px-6 py-4 border-t border-gray-200">
                <form onsubmit="sendChatMessage(event)" class="flex gap-3">
                  <input
                    type="text"
                    id="chatInput"
                    placeholder="Escribe tu mensaje aqu√≠..."
                    class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                    autocomplete="off"
                  />
                  <button
                    type="submit"
                    class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg"
                  >
                    üì§ Enviar
                  </button>
                </form>
              </div>
              <!-- Contact Info Footer -->
              <div class="bg-blue-50 px-6 py-3 border-t border-blue-100">
                <div
                  class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-700"
                >
                  <p>
                    üìç Luis Carracci 107, Extremadura Insurgentes, Benito
                    Ju√°rez, 03740 CDMX
                  </p>
                  <p class="mt-2 md:mt-0">
                    üìû
                    <a
                      href="tel:+525537123224"
                      class="text-blue-600 hover:underline font-semibold"
                      >+52 55 3712 3224</a
                    >
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Global variables
      let currentQuestionIndex = 0;
      let answers = {};
      let evaluations = [];
      let barChart, pieChart, trendChart;

      // Questionnaire data - Dr. Humberto Nicolini's TDA/TDAH Specific Questions
      const questionnaire = {
        categories: {
          atencion: {
            name: "üß† Atenci√≥n y Foco",
            color: "#3b82f6",
            questions: [
              "¬øPude concentrarme en tareas b√°sicas hoy?",
              "¬øMe distraje f√°cilmente incluso en cosas que me interesan?",
              "¬øSent√≠ 'niebla mental' o saturaci√≥n cognitiva?",
              "¬øMe cost√≥ empezar tareas aunque sab√≠a qu√© hacer?",
              "¬øMe cost√≥ terminar lo que empec√©?",
            ],
          },
          organizacion: {
            name: "‚è±Ô∏è Organizaci√≥n y Tiempo",
            color: "#8b5cf6",
            questions: [
              "¬øPerder la noci√≥n del tiempo con facilidad?",
              "¬øLlegu√© tarde o evit√© compromisos por desorganizaci√≥n?",
              "¬øPude priorizar lo importante vs. lo urgente?",
              "¬øMe sent√≠ abrumada al ver muchas tareas juntas?",
            ],
          },
          energia: {
            name: "‚ö° Energ√≠a y Activaci√≥n",
            color: "#f59e0b",
            questions: [
              "¬øC√≥mo estuvo mi nivel de energ√≠a hoy?",
              "¬øHubo picos de hiperfoco?",
              "¬øPas√© de hiperactividad mental a agotamiento?",
              "¬øSent√≠ inquietud f√≠sica o mental constante?",
            ],
          },
          emociones: {
            name: "üåä Regulaci√≥n Emocional",
            color: "#10b981",
            questions: [
              "¬øMis emociones se sintieron intensas o dif√≠ciles de regular?",
              "¬øMe frustr√© f√°cilmente?",
              "¬øSent√≠ culpa o autocr√≠tica excesiva?",
              "¬øTuve momentos de ansiedad sin causa clara?",
            ],
          },
          sueno: {
            name: "üò¥ Sue√±o y Cuerpo",
            color: "#6366f1",
            questions: [
              "¬øDorm√≠ bien?",
              "¬øMe cost√≥ conciliar el sue√±o por pensamientos acelerados?",
              "¬øMe despert√© cansada?",
              "¬øCom√≠ de forma m√°s o menos regular?",
            ],
          },
          medicacion: {
            name: "üíä Medicaci√≥n",
            color: "#ec4899",
            questions: [
              "¬øTom√© la medicaci√≥n como estaba indicada?",
              "¬øNot√© efectos positivos?",
              "¬øEfectos secundarios? (ansiedad, insomnio, baj√≥n, etc.)",
              "¬øLa dosis se sinti√≥ adecuada hoy?",
            ],
          },
          autopercepcion: {
            name: "üå± Autopercepci√≥n",
            color: "#14b8a6",
            questions: [
              "¬øHoy me sent√≠ funcional?",
              "¬øLogr√© algo importante hoy?",
              "¬øHubo algo que me cost√≥ mucho?",
              "¬øMe trat√© con amabilidad?",
            ],
          },
        },
      };

      // Chatbot Knowledge Base
      const botKnowledge = {
        doctorInfo: {
          nombre: "Dr. Jos√© Humberto Nicolini S√°nchez",
          titulo: "M√©dico Cirujano",
          universidad: "Universidad Nacional Aut√≥noma de M√©xico (UNAM)",
          especialidad: "Psiquiatr√≠a - Consejo Mexicano de Psiquiatr√≠a",
          doctorado: "Doctorado en Ciencias M√©dicas - UNAM",
        },
        especialidades: [
          "Trastorno Obsesivo Compulsivo (TOC)",
          "Trastorno Bipolar",
          "Conducta Suicida",
          "Cl√≠nica de Atenci√≥n y Memoria",
          "Ansiedad",
          "Esquizofrenia",
          "Alzheimer",
          "Estimulaci√≥n Magn√©tica Transcraneal",
        ],
        ubicacion: {
          clinica: "Grupo M√©dico Carracci",
          direccion:
            "Luis Carracci 107, Extremadura Insurgentes, Benito Ju√°rez, 03740 Ciudad de M√©xico, CDMX",
          telefono: "+52 55 3712 3224",
          ciudad: "Ciudad de M√©xico",
        },
        tratamientos: {
          toc: "El Dr. Nicolini es experto en Trastorno Obsesivo Compulsivo. Utiliza terapias especializadas y medicaci√≥n cuando es necesario.",
          bipolar:
            "El Trastorno Bipolar requiere tratamiento especializado. El Dr. Nicolini cuenta con amplia experiencia en el manejo de episodios man√≠acos y depresivos.",
          ansiedad:
            "Los trastornos de ansiedad son tratables. El Dr. Nicolini ofrece evaluaci√≥n completa y tratamiento integral.",
          esquizofrenia:
            "La esquizofrenia requiere manejo especializado. El Dr. Nicolini ofrece tratamiento integral.",
          alzheimer:
            "En la Cl√≠nica de Atenci√≥n y Memoria, el Dr. Nicolini atiende casos de Alzheimer y otros trastornos neurodegenerativos.",
          suicida:
            "Si tienes pensamientos suicidas, el Dr. Nicolini puede ayudarte. Llama al +52 55 3712 3224.",
          tms: "La Estimulaci√≥n Magn√©tica Transcraneal es un tratamiento no invasivo para depresi√≥n resistente. El Dr. Nicolini ofrece esta t√©cnica avanzada.",
        },
      };

      const quickActionsBot = [
        { text: "üìÖ Agendar cita", action: "agendar" },
        { text: "üè• Especialidades", action: "especialidades" },
        { text: "üìç Ubicaci√≥n", action: "ubicacion" },
        { text: "üë®‚Äç‚öïÔ∏è Sobre el Dr.", action: "doctor" },
        { text: "üìû Contacto", action: "contacto" },
      ];

      // Flatten questions for easier navigation
      let allQuestions = [];
      Object.keys(questionnaire.categories).forEach((categoryKey) => {
        const category = questionnaire.categories[categoryKey];
        category.questions.forEach((question, index) => {
          allQuestions.push({
            category: categoryKey,
            categoryName: category.name,
            question: question,
            questionIndex: index,
            color: category.color,
          });
        });
      });

      // Initialize the application
      function init() {
        updateDateTime();
        setInterval(updateDateTime, 1000);
        loadEvaluations();
        setupQuestionnaire();
        showSection("questionnaire");

        // Set today's date
        document.getElementById("evaluationDate").value = new Date()
          .toISOString()
          .split("T")[0];
      }

      // Update date and time
      function updateDateTime() {
        const now = new Date();
        document.getElementById("currentDate").textContent =
          now.toLocaleDateString("es-ES", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        document.getElementById("currentTime").textContent =
          now.toLocaleTimeString("es-ES", {
            hour: "2-digit",
            minute: "2-digit",
          });
      }

      // Setup questionnaire
      function setupQuestionnaire() {
        document.getElementById("totalQuestions").textContent =
          allQuestions.length;
        displayCurrentQuestion();
      }

      // Display current question
      function displayCurrentQuestion() {
        const container = document.getElementById("questionsContainer");
        const question = allQuestions[currentQuestionIndex];

        document.getElementById("currentQuestion").textContent =
          currentQuestionIndex + 1;
        updateProgressBar();

        container.innerHTML = `
                <div class="question-card bg-white p-8 rounded-xl border-2 shadow-lg fade-in" style="border-left-color: ${
                  question.color
                }">
                    <div class="mb-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-4 h-4 rounded-full" style="background-color: ${
                              question.color
                            }"></div>
                            <span class="text-sm font-semibold text-gray-600 uppercase tracking-wide">${
                              question.categoryName
                            }</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Pregunta ${
                          currentQuestionIndex + 1
                        }</h3>
                        <p class="text-lg text-gray-700">${
                          question.question
                        }</p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                        ${generateScaleButtons(currentQuestionIndex)}
                    </div>
                    
                    <div class="mt-6 text-center">
                        <div class="flex justify-between text-sm text-gray-500">
                            <span>0 = Nada / Nunca</span>
                            <span>5 = Mucho / Siempre</span>
                        </div>
                    </div>
                </div>
            `;

        // Update navigation buttons
        document.getElementById("prevBtn").disabled =
          currentQuestionIndex === 0;

        if (currentQuestionIndex === allQuestions.length - 1) {
          document.getElementById("nextBtn").classList.add("hidden");
          document.getElementById("finishBtn").classList.remove("hidden");
        } else {
          document.getElementById("nextBtn").classList.remove("hidden");
          document.getElementById("finishBtn").classList.add("hidden");
        }
      }

      // Generate scale buttons (0-5 scale)
      function generateScaleButtons(questionIndex) {
        const scales = [
          { value: 0, label: "0" },
          { value: 1, label: "1" },
          { value: 2, label: "2" },
          { value: 3, label: "3" },
          { value: 4, label: "4" },
          { value: 5, label: "5" },
        ];

        return scales
          .map((scale) => {
            const isSelected = answers[questionIndex] === scale.value;
            return `
                    <button onclick="selectAnswer(${questionIndex}, ${
              scale.value
            })" 
                            class="scale-button ${
                              isSelected ? "selected" : ""
                            } p-4 rounded-xl border-2 text-center transition-all hover:shadow-lg ${
              isSelected
                ? "bg-blue-600 text-white border-blue-600"
                : "bg-white text-gray-700 border-gray-300 hover:border-blue-400"
            }">
                        <div class="text-2xl font-bold">${scale.label}</div>
                    </button>
                `;
          })
          .join("");
      }

      // Select answer
      function selectAnswer(questionIndex, value) {
        answers[questionIndex] = value;
        displayCurrentQuestion();
      }

      // Update progress bar
      function updateProgressBar() {
        const progress =
          ((currentQuestionIndex + 1) / allQuestions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
      }

      // Navigation functions
      function nextQuestion() {
        if (answers[currentQuestionIndex] === undefined) {
          showInlineMessage(
            " Por favor responde la pregunta actual antes de continuar"
          );
          return;
        }

        if (currentQuestionIndex < allQuestions.length - 1) {
          currentQuestionIndex++;
          displayCurrentQuestion();
        }
      }

      function previousQuestion() {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          displayCurrentQuestion();
        }
      }

      // Show inline message (no browser dialog)
      function showInlineMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className =
          "fixed top-4 right-4 bg-yellow-500 text-white px-6 py-4 rounded-lg shadow-lg z-50";
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      // Finish evaluation
      function finishEvaluation() {
        if (answers[currentQuestionIndex] === undefined) {
          showInlineMessage(
            "‚ö†Ô∏è Por favor responde la pregunta actual antes de finalizar"
          );
          return;
        }

        const patientName = document.getElementById("patientName").value.trim();
        const patientAge = document.getElementById("patientAge").value;
        const evaluationDate = document.getElementById("evaluationDate").value;

        if (!patientName || !patientAge || !evaluationDate) {
          showInlineMessage(
            "‚ö†Ô∏è Por favor completa la informaci√≥n del paciente"
          );
          return;
        }

        // Calculate scores
        const scores = calculateScores();

        // Save evaluation
        const evaluation = {
          id: Date.now(),
          patientName,
          patientAge: parseInt(patientAge),
          date: evaluationDate,
          answers: { ...answers },
          scores: scores,
          timestamp: new Date().toISOString(),
        };

        evaluations.push(evaluation);
        saveEvaluations();

        // Show results
        displayResults(evaluation);
        showSection("results");

        showInlineMessage("‚úÖ Evaluaci√≥n completada exitosamente");
      }

      // Calculate scores by category
      function calculateScores() {
        const scores = {};

        Object.keys(questionnaire.categories).forEach((categoryKey) => {
          const category = questionnaire.categories[categoryKey];
          let totalScore = 0;
          let questionCount = 0;

          allQuestions.forEach((q, index) => {
            if (q.category === categoryKey && answers[index] !== undefined) {
              totalScore += answers[index];
              questionCount++;
            }
          });

          scores[categoryKey] = {
            name: category.name,
            total: totalScore,
            average:
              questionCount > 0 ? (totalScore / questionCount).toFixed(1) : 0,
            percentage:
              questionCount > 0
                ? ((totalScore / (questionCount * 5)) * 100).toFixed(1)
                : 0,
            color: category.color,
            questionCount: questionCount,
          };
        });

        return scores;
      }

      // Display results
      function displayResults(evaluation) {
        displayScores(evaluation.scores);
        createCharts(evaluation.scores);
      }

      // Display scores
      function displayScores(scores) {
        const container = document.getElementById("scoresDisplay");

        container.innerHTML = Object.values(scores)
          .map((score) => {
            return `
                    <div class="p-4 bg-white rounded-lg border-l-4 shadow-sm" style="border-left-color: ${score.color}">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-gray-800">${score.name}</h4>
                            <span class="text-2xl font-bold" style="color: ${score.color}">${score.percentage}%</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            Puntuaci√≥n Total: ${score.total} | Promedio: ${score.average}
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-1000" 
                                 style="width: ${score.percentage}%; background-color: ${score.color}"></div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      // Create charts
      function createCharts(scores) {
        createBarChart(scores);
        createPieChart(scores);
      }

      // Create bar chart
      function createBarChart(scores) {
        const ctx = document.getElementById("barChart").getContext("2d");

        if (barChart) {
          barChart.destroy();
        }

        const labels = Object.values(scores).map((s) => s.name);
        const data = Object.values(scores).map((s) => s.total);
        const colors = Object.values(scores).map((s) => s.color);

        barChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Puntuaci√≥n Total",
                data: data,
                backgroundColor: colors,
                borderColor: colors,
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              title: {
                display: true,
                text: "Puntuaciones por Categor√≠a TDA/TDAH",
                font: {
                  size: 16,
                  weight: "bold",
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                max: Math.max(...data) + 5,
                ticks: {
                  stepSize: 1,
                },
              },
            },
            animation: {
              duration: 1500,
              easing: "easeOutBounce",
            },
          },
        });
      }

      // Create pie chart
      function createPieChart(scores) {
        const ctx = document.getElementById("pieChart").getContext("2d");

        if (pieChart) {
          pieChart.destroy();
        }

        const labels = Object.values(scores).map((s) => s.name);
        const data = Object.values(scores).map((s) => parseFloat(s.percentage));
        const colors = Object.values(scores).map((s) => s.color);

        pieChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                backgroundColor: colors,
                borderColor: "#ffffff",
                borderWidth: 3,
                hoverOffset: 10,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  font: {
                    size: 12,
                  },
                },
              },
              title: {
                display: true,
                text: "Distribuci√≥n de S√≠ntomas TDA/TDAH (%)",
                font: {
                  size: 16,
                  weight: "bold",
                },
              },
            },
            animation: {
              animateRotate: true,
              duration: 2000,
            },
          },
        });
      }

      // Show section
      function showSection(sectionName) {
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.add("hidden");
        });

        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove(
            "bg-gradient-to-r",
            "from-blue-600",
            "to-indigo-600",
            "text-white"
          );
          item.classList.add("bg-gray-200", "text-gray-700");
        });

        document
          .getElementById(sectionName + "-section")
          .classList.remove("hidden");

        const activeNav = document.getElementById("nav-" + sectionName);
        activeNav.classList.add(
          "bg-gradient-to-r",
          "from-blue-600",
          "to-indigo-600",
          "text-white"
        );
        activeNav.classList.remove("bg-gray-200", "text-gray-700");

        if (sectionName === "history") {
          displayHistory();
        } else if (sectionName === "chatbot") {
          const messagesArea = document.getElementById("chatMessages");
          if (messagesArea.children.length === 0) {
            initChatbot();
          }
        }
      }

      // Display history
      function displayHistory() {
        const container = document.getElementById("historyList");

        if (evaluations.length === 0) {
          container.innerHTML =
            '<p class="text-gray-500 text-center py-8">No hay evaluaciones previas en esta sesi√≥n</p>';
          return;
        }

        createTrendChart();

        const sortedEvaluations = evaluations.sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        container.innerHTML = sortedEvaluations
          .map(
            (evaluation) => `
                <div class="card-hover bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">${
                              evaluation.patientName
                            }</h3>
                            <p class="text-sm text-gray-600">Edad: ${
                              evaluation.patientAge
                            } a√±os</p>
                            <p class="text-sm text-gray-600">Fecha: ${new Date(
                              evaluation.date
                            ).toLocaleDateString("es-ES")}</p>
                        </div>
                        <button onclick="viewEvaluation(${
                          evaluation.id
                        })" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            üëÅÔ∏è Ver Detalles
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        ${Object.values(evaluation.scores)
                          .map(
                            (score) => `
                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                <div class="text-sm font-semibold text-gray-600">${score.name}</div>
                                <div class="text-xl font-bold" style="color: ${score.color}">${score.total}</div>
                                <div class="text-xs text-gray-500">${score.percentage}%</div>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Create trend chart
      function createTrendChart() {
        const ctx = document.getElementById("trendChart").getContext("2d");

        if (trendChart) {
          trendChart.destroy();
        }

        if (evaluations.length < 2) {
          ctx.canvas.parentElement.innerHTML =
            '<p class="text-gray-500 text-center py-8">Se necesitan al menos 2 evaluaciones para mostrar tendencias</p>';
          return;
        }

        const sortedEvaluations = evaluations.sort(
          (a, b) => new Date(a.date) - new Date(b.date)
        );
        const labels = sortedEvaluations.map((e) =>
          new Date(e.date).toLocaleDateString("es-ES")
        );

        const datasets = Object.keys(questionnaire.categories).map(
          (categoryKey) => {
            const category = questionnaire.categories[categoryKey];
            return {
              label: category.name,
              data: sortedEvaluations.map((e) =>
                e.scores[categoryKey] ? e.scores[categoryKey].total : 0
              ),
              borderColor: category.color,
              backgroundColor: category.color + "20",
              borderWidth: 3,
              fill: false,
              tension: 0.4,
              pointRadius: 6,
              pointHoverRadius: 8,
            };
          }
        );

        trendChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
                labels: {
                  usePointStyle: true,
                  padding: 20,
                },
              },
              title: {
                display: true,
                text: "Evoluci√≥n de S√≠ntomas TDA/TDAH",
                font: {
                  size: 16,
                  weight: "bold",
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Puntuaci√≥n",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Fecha",
                },
              },
            },
            animation: {
              duration: 2000,
            },
          },
        });
      }

      // View specific evaluation
      function viewEvaluation(id) {
        const evaluation = evaluations.find((e) => e.id === id);
        if (evaluation) {
          displayResults(evaluation);
          showSection("results");
        }
      }

      // Print results
      function printResults() {
        window.print();
      }

      // Save evaluations to sessionStorage
      function saveEvaluations() {
        sessionStorage.setItem(
          "psychiatricEvaluations",
          JSON.stringify(evaluations)
        );
      }

      // Load evaluations from sessionStorage
      function loadEvaluations() {
        const saved = sessionStorage.getItem("psychiatricEvaluations");
        if (saved) {
          evaluations = JSON.parse(saved);
        }
      }

      // Export to Excel
      function exportToExcel() {
        if (evaluations.length === 0) {
          showInlineMessage("‚ö†Ô∏è No hay evaluaciones para exportar");
          return;
        }

        let csvContent = "\ufeff";
        csvContent +=
          "SISTEMA DE EVALUACI√ìN TDA/TDAH - Dr. Humberto Nicolini\n\n";
        csvContent +=
          "Fecha,Nombre del Paciente,Edad,Categor√≠a,Puntuaci√≥n Total,Promedio,Porcentaje\n";

        evaluations.forEach((evaluation) => {
          Object.values(evaluation.scores).forEach((score) => {
            csvContent += `${evaluation.date},${evaluation.patientName},${evaluation.patientAge},${score.name},${score.total},${score.average},${score.percentage}%\n`;
          });
        });

        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.href = url;
        link.download = `Evaluaciones_TDA_${
          new Date().toISOString().split("T")[0]
        }.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        showInlineMessage("‚úÖ Datos exportados exitosamente");
      }

      // ==================== CHATBOT FUNCTIONS ====================

      // Initialize chatbot
      function initChatbot() {
        addChatMessage(
          "bot",
          `¬°Hola! üëã Soy el asistente virtual del ${botKnowledge.doctorInfo.nombre}.\n\nEstoy aqu√≠ para ayudarte con:\n\n‚Ä¢ üìã Informaci√≥n sobre especialidades\n‚Ä¢ üìÖ C√≥mo agendar una cita\n‚Ä¢ üìç Ubicaci√≥n de la cl√≠nica\n‚Ä¢ üíä Tratamientos disponibles\n\n¬øEn qu√© puedo ayudarte?`
        );
        renderQuickActionsBot();
      }

      // Render quick actions for bot
      function renderQuickActionsBot() {
        const container = document.getElementById("quickActions");
        container.innerHTML = quickActionsBot
          .map(
            (action) => `
                <button onclick="handleQuickActionBot('${action.action}')" class="quick-action-btn bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg text-sm font-semibold">
                    ${action.text}
                </button>
            `
          )
          .join("");
      }

      // Handle quick actions
      function handleQuickActionBot(action) {
        const responses = {
          agendar: `üìÖ AGENDAR CITA\n\nPara agendar tu cita:\n\nüìû LLAMAR:\n+52 55 3712 3224\n\nüìç ACUDIR:\nGrupo M√©dico Carracci\nLuis Carracci 107, CDMX\n\n¬øTienes alguna otra pregunta?`,

          especialidades: `üè• ESPECIALIDADES:\n\n${botKnowledge.especialidades
            .map((esp, i) => `${i + 1}. ${esp}`)
            .join("\n")}\n\n¬øSobre cu√°l te gustar√≠a saber m√°s?`,

          ubicacion: `üìç UBICACI√ìN:\n\nüè• ${botKnowledge.ubicacion.clinica}\n\nüìç ${botKnowledge.ubicacion.direccion}\n\nüìû ${botKnowledge.ubicacion.telefono}\n\n¬øNecesitas m√°s informaci√≥n?`,

          doctor: `üë®‚Äç‚öïÔ∏è SOBRE EL DR. NICOLINI\n\n${botKnowledge.doctorInfo.nombre}\n\nüéì Formaci√≥n:\n‚Ä¢ ${botKnowledge.doctorInfo.titulo} - ${botKnowledge.doctorInfo.universidad}\n‚Ä¢ ${botKnowledge.doctorInfo.especialidad}\n‚Ä¢ ${botKnowledge.doctorInfo.doctorado}\n\n¬øTe gustar√≠a agendar una cita?`,

          contacto: `üìû CONTACTO:\n\nüì± ${botKnowledge.ubicacion.telefono}\n\nüìç ${botKnowledge.ubicacion.direccion}\n\n¬øEn qu√© m√°s puedo ayudarte?`,
        };

        addChatMessage(
          "user",
          quickActionsBot.find((a) => a.action === action).text
        );
        setTimeout(() => {
          addChatMessage("bot", responses[action]);
        }, 800);
      }

      // Send chat message
      function sendChatMessage(event) {
        event.preventDefault();

        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (!message) return;

        addChatMessage("user", message);
        input.value = "";

        setTimeout(() => {
          showTypingIndicatorBot();

          setTimeout(() => {
            hideTypingIndicatorBot();
            const response = generateBotResponse(message);
            addChatMessage("bot", response);
          }, 1500);
        }, 500);
      }

      // Generate bot response
      function generateBotResponse(userMessage) {
        const message = userMessage.toLowerCase();

        if (message.match(/hola|buenos d√≠as|buenas tardes|hey/)) {
          return `¬°Hola! üëã ¬øEn qu√© puedo ayudarte?\n\nPuedo darte informaci√≥n sobre:\n‚Ä¢ Especialidades del Dr. Nicolini\n‚Ä¢ C√≥mo agendar cita\n‚Ä¢ Ubicaci√≥n\n‚Ä¢ Tratamientos`;
        }

        if (message.match(/cita|agendar|consulta|reservar/)) {
          return `üìÖ Para agendar:\n\nüìû Llama al: +52 55 3712 3224\n\nüìç O acude a:\nGrupo M√©dico Carracci\nLuis Carracci 107, CDMX\n\n¬øNecesitas la ubicaci√≥n exacta?`;
        }

        if (message.match(/ubicaci√≥n|direcci√≥n|donde|d√≥nde/)) {
          return `üìç UBICACI√ìN:\n\n${botKnowledge.ubicacion.clinica}\n${botKnowledge.ubicacion.direccion}\n\nüìû ${botKnowledge.ubicacion.telefono}`;
        }

        if (message.match(/tel√©fono|telefono|contacto|llamar/)) {
          return `üìû CONTACTO:\n\nTel√©fono: ${botKnowledge.ubicacion.telefono}\n\n¬°Llama para agendar tu cita!`;
        }

        if (message.match(/especialidad|especialidades|trata/)) {
          return `üè• ESPECIALIDADES:\n\n${botKnowledge.especialidades
            .map((esp, i) => `${i + 1}. ${esp}`)
            .join("\n")}\n\n¬øSobre cu√°l quieres saber m√°s?`;
        }

        if (message.match(/toc|obsesivo|compulsivo/)) {
          return `üîÑ TOC:\n\n${botKnowledge.tratamientos.toc}\n\nüìû Agenda: +52 55 3712 3224`;
        }

        if (message.match(/bipolar/)) {
          return `üé≠ TRASTORNO BIPOLAR:\n\n${botKnowledge.tratamientos.bipolar}\n\n +52 55 3712 3224`;
        }

        if (message.match(/ansiedad|ansioso|estr√©s/)) {
          return `üò∞ ANSIEDAD:\n\n${botKnowledge.tratamientos.ansiedad}\n\nüìû +52 55 3712 3224`;
        }

        if (message.match(/esquizofrenia/)) {
          return `üß© ESQUIZOFRENIA:\n\n${botKnowledge.tratamientos.esquizofrenia}\n\nüìû +52 55 3712 3224`;
        }

        if (message.match(/alzheimer|memoria/)) {
          return `üß† ALZHEIMER Y MEMORIA:\n\n${botKnowledge.tratamientos.alzheimer}\n\nüìû +52 55 3712 3224`;
        }

        if (message.match(/suicid/)) {
          return `üÜò AYUDA:\n\n${botKnowledge.tratamientos.suicida}\n\nüö® Emergencia: 911\nL√≠nea de la Vida: 800 911 2000`;
        }

        if (message.match(/estimulaci√≥n|tms|transcraneal/)) {
          return `‚ö° TMS:\n\n${botKnowledge.tratamientos.tms}\n\nüìû M√°s info: +52 55 3712 3224`;
        }

        if (message.match(/doctor|m√©dico|nicolini/)) {
          return `üë®‚Äç‚öïÔ∏è ${botKnowledge.doctorInfo.nombre}\n\nüéì ${botKnowledge.doctorInfo.especialidad}\nüéì ${botKnowledge.doctorInfo.doctorado}\n\nüìû +52 55 3712 3224`;
        }

        if (message.match(/precio|costo|cuanto/)) {
          return `üí∞ COSTOS:\n\nPara informaci√≥n sobre costos:\nüìû Llama al: +52 55 3712 3224\n\nEl personal te informar√° sobre honorarios y formas de pago.`;
        }

        if (message.match(/gracias/)) {
          return `¬°De nada! üòä\n\n¬øAlgo m√°s?\n\nüìû +52 55 3712 3224`;
        }

        if (message.match(/adi√≥s|adios|bye/)) {
          return `¬°Hasta pronto! üëã\n\nüìû +52 55 3712 3224\nüìç Luis Carracci 107, CDMX`;
        }

        return `Entiendo. ü§î\n\nPuedo ayudarte con:\n‚Ä¢ üìÖ Agendar citas\n‚Ä¢ üè• Especialidades\n‚Ä¢ üìç Ubicaci√≥n\n‚Ä¢ üíä Tratamientos\n\n¬øSobre qu√© quieres saber?\n\nüìû O llama: +52 55 3712 3224`;
      }

      // Add message to chat
      function addChatMessage(sender, text) {
        const messagesDiv = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `chat-message mb-4 ${
          sender === "user" ? "text-right" : "text-left"
        }`;

        const isBot = sender === "bot";
        const bubbleClass = isBot
          ? "bg-white border-2 border-blue-200 text-gray-800"
          : "bg-gradient-to-r from-blue-600 to-indigo-600 text-white";

        messageDiv.innerHTML = `
                <div class="inline-block max-w-lg">
                    ${isBot ? '<div class="flex items-start space-x-2">' : ""}
                    ${
                      isBot
                        ? '<div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-white text-sm">ü§ñ</span></div>'
                        : ""
                    }
                    <div class="${bubbleClass} px-4 py-3 rounded-2xl shadow-md ${
          isBot ? "rounded-tl-none" : "rounded-tr-none"
        }">
                        <p class="text-sm whitespace-pre-line">${text}</p>
                    </div>
                    ${isBot ? "</div>" : ""}
                </div>
            `;

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Show typing indicator
      function showTypingIndicatorBot() {
        const messagesDiv = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");
        typingDiv.id = "typingIndicatorBot";
        typingDiv.className = "chat-message mb-4 text-left";
        typingDiv.innerHTML = `
                <div class="inline-block">
                    <div class="flex items-start space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm">ü§ñ</span>
                        </div>
                        <div class="bg-white border-2 border-blue-200 px-4 py-3 rounded-2xl rounded-tl-none shadow-md">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        messagesDiv.appendChild(typingDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Hide typing indicator
      function hideTypingIndicatorBot() {
        const indicator = document.getElementById("typingIndicatorBot");
        if (indicator) {
          indicator.remove();
        }
      }

      // Clear chat
      function clearChat() {
        document.getElementById("chatMessages").innerHTML = "";
        initChatbot();
      }

      // Initialize the application when the page loads
      document.addEventListener("DOMContentLoaded", init);
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9c0229b3e008ac50',t:'MTc2ODc4MTk5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
